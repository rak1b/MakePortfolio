{% load socialaccount %}
<div class="bg-white w-50 m-auto p-5">
  <div class="p-5 flex flex-row" style="display: flex">
    <div class="signup-form w-50 bg-success p-5" id="signupForm">
      <form action="" method="POST">
        {% csrf_token %}
        <h1 class="text-capitalize text-center">Create an Account</h1>
        <p class="hint-text text-center">
          Sign up with your social media account or email address
        </p>

        <div class="form-group mt-4">
          <input
            type="text"
            class="form-control input-lg"
            name="username"
            placeholder="Username"
            required="required"
          />
        </div>
        <div class="form-group mt-4">
          <input
            type="email"
            class="form-control input-lg"
            name="email"
            placeholder="Email Address"
            required="required"
          />
        </div>
        <div class="form-group mt-4">
          <input
            type="password"
            class="form-control input-lg"
            name="password"
            placeholder="Password"
            required="required"
          />
        </div>
        <div class="form-group mt-4">
          <input
            type="password"
            class="form-control input-lg"
            name="confirm_password"
            placeholder="Confirm Password"
            required="required"
          />
        </div>

        <div class="form-group mt-4">
          <input
            id="signup_btn"
            type="button"
            class="btn btn-outline-light btn-lg btn-block signup-btn"
            value="Sign Up"
          />
        </div>
      </form>

      <!-- <div class="text-center">Already have an account? <a id="openLogin" href="#">Login here</a></div> -->
    </div>

    <div class="login-form w-50 bg-info p-5" id="loginForm">
      <form action="" method="post">
        {% csrf_token %}

        <h1 class="text-capitalize text-center">Login</h1>
        <p class="hint-text text-center">Login with gmail or email address</p>

        <div class="form-group mt-4">
          <input
            type="text"
            class="form-control input-lg"
            name="login_username"
            placeholder="Username"
            required="required"
          />
        </div>
        <div class="form-group mt-4">
          <input
            type="password"
            class="form-control input-lg"
            name="login_password"
            placeholder="Password"
            required="required"
          />
        </div>

        <div class="form-group mt-4 text-black">
          <input
            id="login_btn"
            type="button"
            class="btn btn-outline-light btn-lg btn-block login-btn"
            value="Login"
          />
        </div>
      </form>
    </div>
  </div>

  <div class="or-seperator text-center text-capitalize text-danger my-4">
    <b>or</b>
  </div>

  <div class="social-btn text-center">
    <h4 class="text-danger">
      Login With
      <a href="{% provider_login_url 'google' %}" class="btn btn-danger btn-lg"
        ><i class="fa fa-google"></i> Google</a
      >
    </h4>
  </div>
</div>

<script>
  const signup_function = () => {
    $("#signup_btn").click(() => {
      const username = document.getElementsByName("username")[0].value;
      const email = document.getElementsByName("email")[0].value;
      const password = document.getElementsByName("password")[0].value;
      const confirm_password =
        document.getElementsByName("confirm_password")[0].value;
      const csrfmiddlewaretoken = document.getElementsByName(
        "csrfmiddlewaretoken"
      )[0].value;

      if (
        username === "" ||
        email === "" ||
        password === "" ||
        confirm_password === ""
      ) {
        alert("Fields Can Not Be Empty..");
      } else if (password != confirm_password) {
        alert("Password didn't match..");
      }

      const data = {
        username: username,
        email: email,
        password: password,
        csrfmiddlewaretoken: csrfmiddlewaretoken,
      };
      $.ajax({
        url: "{% url 'register' %}",
        method: "POST",
        data: data,
        success: (res) => {
          console.log(res);
          alert("Account Created Successfully..");
        },
        error:(error)=>{
          alert("Sign Up Failed..");

        }
      });

      console.log("signup update btn clicked");
    });
  };

  const Login_function = () => {
    $("#login_btn").click(() => {
      console.log("login button clicked");
      const username = document.getElementsByName("login_username")[0].value;
      const password = document.getElementsByName("login_password")[0].value;
      const csrfmiddlewaretoken = document.getElementsByName(
        "csrfmiddlewaretoken"
      )[0].value;
      const data = {
        username: username,
        password: password,
        csrfmiddlewaretoken: csrfmiddlewaretoken,
      };
      $.ajax({
        url: "{% url 'login' %}",
        method: "POST",
        data: data,
        success: (res) => {
          console.log(res);
        },
        error:(res)=>{
          console.log(res);
          window.location.reload(true);
        }
      });

    });
    
  };

  $(document).ready(() => {
    signup_function();
    Login_function();
  });
</script>
